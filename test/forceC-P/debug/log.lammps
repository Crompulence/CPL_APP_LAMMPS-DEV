LAMMPS (17 Nov 2016)
# LAMMPS

variable	xx equal 300
variable	yy equal 300
variable	zz equal 300

# Cells' dimensions
variable dx equal 20
variable dy equal 20
variable dz equal 20


units		real
atom_style	atomic

lattice		fcc 10
Lattice spacing in x,y,z = 10 10 10
region		box block 0 ${xx} 0 ${yy} 0 ${zz} units box
region		box block 0 300 0 ${yy} 0 ${zz} units box
region		box block 0 300 0 300 0 ${zz} units box
region		box block 0 300 0 300 0 300 units box
boundary p p p
create_box	1 box
Created orthogonal box = (0 0 0) to (300 300 300)
  3 by 3 by 3 MPI processor grid

region fluidregion block 0 ${xx} 0 ${yy} 0 ${zz} units box
region fluidregion block 0 300 0 ${yy} 0 ${zz} units box
region fluidregion block 0 300 0 300 0 ${zz} units box
region fluidregion block 0 300 0 300 0 300 units box

# The force constrain fix is acting in a x-y slab of one cell big in y
region constrainreg block 0 ${xx} $(v_yy - 3*v_dy) ${yy}  0 ${zz} units box
region constrainreg block 0 300 $(v_yy - 3*v_dy) ${yy}  0 ${zz} units box
region constrainreg block 0 300 240 ${yy}  0 ${zz} units box
region constrainreg block 0 300 240 300  0 ${zz} units box
region constrainreg block 0 300 240 300  0 300 units box

create_atoms 1 region fluidregion units box
Created 108000 atoms

mass		1 1.0

velocity	all create 1000.0 87287 loop geom

pair_style	lj/cut 10
pair_coeff	1 1 2.5 3.4

neighbor	2.0 bin
neigh_modify delay 0 every 1 check yes

fix 1 all nve

# Atoms do not interact at all so forces can be only
# modified from lammps forece fix.
neigh_modify exclude type 1 1

# Move a bit the atoms so there is no lattice arrangement anymore
run 10
Neighbor list info ...
  1 neighbor list requests
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 12
  ghost atom cutoff = 12
  binsize = 6 -> bins = 50 50 50
Memory usage per processor = 2.64967 Mbytes
Step Temp E_pair E_mol TotEng Press 
       0         1000            0            0     321924.5    545.03341 
      10         1000            0            0     321924.5    545.03341 
Loop time of 3.95671 on 27 procs for 10 steps with 108000 atoms

Performance: 0.218 ns/day, 109.909 hours/ns, 2.527 timesteps/s
12.7% CPU use with 27 MPI tasks x no OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.00025892 | 0.00036413 | 0.00095868 |   0.6 |  0.01
Neigh   | 0          | 0          | 0          |   0.0 |  0.00
Comm    | 1.6844     | 2.0964     | 2.3726     |  10.8 | 52.98
Output  | 0.53194    | 0.57473    | 0.61548    |   2.7 | 14.53
Modify  | 0.00060987 | 0.0010058  | 0.0065637  |   3.6 |  0.03
Other   |            | 1.284      |            |       | 32.46

Nlocal:    4000 ave 4000 max 4000 min
Histogram: 27 0 0 0 0 0 0 0 0 0
Nghost:    3813 ave 3813 max 3813 min
Histogram: 27 0 0 0 0 0 0 0 0 0
Neighs:    0 ave 0 max 0 min
Histogram: 27 0 0 0 0 0 0 0 0 0

Total # of neighbors = 0
Ave neighs/atom = 0
Neighbor list builds = 0
Dangerous builds = 0

# Do not integrate
unfix 1

# Stop atoms from moving. Forces are zero since interactions have been turned
# off.
velocity all set 0 0 0 units box

# IMPORTANT for not messing the internal average for BCs in the CPLSocket for LAMMPS
reset_timestep 0

compute ffieldcompute all chunk/atom bin/3d x lower ${dx} y lower ${dy} z  lower ${dz} region constrainreg ids every units box
compute ffieldcompute all chunk/atom bin/3d x lower 20 y lower ${dy} z  lower ${dz} region constrainreg ids every units box
compute ffieldcompute all chunk/atom bin/3d x lower 20 y lower 20 z  lower ${dz} region constrainreg ids every units box
compute ffieldcompute all chunk/atom bin/3d x lower 20 y lower 20 z  lower 20 region constrainreg ids every units box

# The output shows the middle coordinate of each box (10, 10, 10) for the first box in this case
# The dumped forces should be the ones imposed by the constrained region.
fix ffieldfix all ave/chunk 1 1 1 ffieldcompute fx fy fz norm none file lammps_forces.dat format %20.16g

print "---RUN COUPLED---"
---RUN COUPLED---

fix cplfix all cpl/init midplane momentumc fleckoy
variable CPLSTEPS equal 1
run ${CPLSTEPS}
run 1
group cplforcegroup dynamic all region cplforceregion every 1
dynamic group cplforcegroup defined
Memory usage per processor = 3.17433 Mbytes
Step Temp E_pair E_mol TotEng Press 
       0            0            0            0            0            0 
       1            0            0            0            0            0 
Loop time of 2.05876 on 27 procs for 1 steps with 108000 atoms

Performance: 0.042 ns/day, 571.877 hours/ns, 0.486 timesteps/s
12.7% CPU use with 27 MPI tasks x no OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 5.4836e-05 | 0.00012185 | 0.00037408 |   0.8 |  0.01
Neigh   | 0          | 0          | 0          |   0.0 |  0.00
Comm    | 0.13969    | 0.19837    | 0.23194    |   4.6 |  9.64
Output  | 0.50803    | 0.63159    | 0.76794    |   7.6 | 30.68
Modify  | 0.86403    | 0.9979     | 1.1198     |   5.9 | 48.47
Other   |            | 0.2308     |            |       | 11.21

Nlocal:    4000 ave 4044 max 3964 min
Histogram: 1 1 3 10 4 2 3 0 0 3
Nghost:    3813 ave 3849 max 3769 min
Histogram: 3 0 0 3 2 3 10 4 1 1
Neighs:    0 ave 0 max 0 min
Histogram: 27 0 0 0 0 0 0 0 0 0

Total # of neighbors = 0
Ave neighs/atom = 0
Neighbor list builds = 0
Dangerous builds = 0
Total wall time: 0:00:27
